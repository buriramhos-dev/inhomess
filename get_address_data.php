<?php
header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');

// ข้อมูลจังหวัด อำเภอ ตำบลของประเทศไทย
// ใช้ข้อมูลจาก API หรือไฟล์ JSON

$action = $_GET['action'] ?? '';

if ($action === 'provinces') {
    // ส่งรายชื่อจังหวัด (เฉพาะบุรีรัมย์)
    $provinces = ['บุรีรัมย์'];
    echo json_encode($provinces, JSON_UNESCAPED_UNICODE);
    exit;
}

if ($action === 'amphurs' && isset($_GET['province'])) {
    $province = $_GET['province'];
    
    // ข้อมูลอำเภอตามจังหวัด (ตัวอย่าง - ควรมีข้อมูลครบถ้วน)
    $amphurs = getAmphursByProvince($province);
    echo json_encode($amphurs, JSON_UNESCAPED_UNICODE);
    exit;
}

if ($action === 'tambons' && isset($_GET['province']) && isset($_GET['amphur'])) {
    $province = $_GET['province'];
    $amphur = $_GET['amphur'];
    
    // ข้อมูลตำบลตามจังหวัดและอำเภอ (ตัวอย่าง - ควรมีข้อมูลครบถ้วน)
    $tambons = getTambonsByProvinceAndAmphur($province, $amphur);
    echo json_encode($tambons, JSON_UNESCAPED_UNICODE);
    exit;
}

// ฟังก์ชันดึงอำเภอตามจังหวัด
function getAmphursByProvince($province) {
    // ถ้าเป็นบุรีรัมย์ ให้ใช้ไฟล์ buriram_addresses.json
    if ($province === 'บุรีรัมย์') {
        $jsonFile = __DIR__ . '/buriram_addresses.json';
        if (file_exists($jsonFile)) {
            $jsonData = file_get_contents($jsonFile);
            $data = json_decode($jsonData, true);
            if (isset($data['amphurs'])) {
                return array_keys($data['amphurs']);
            }
        }
    }
    
    // ลองโหลดจากไฟล์ JSON ก่อน
    $jsonFile = __DIR__ . '/thailand_addresses.json';
    if (file_exists($jsonFile)) {
        $jsonData = file_get_contents($jsonFile);
        $data = json_decode($jsonData, true);
        if (isset($data['provinces'][$province])) {
            return array_keys($data['provinces'][$province]);
        }
    }
    
    // ลองดึงข้อมูลจาก API
    $apiUrl = "https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/provinces/{$province}.json";
    
    $context = stream_context_create([
        'http' => [
            'timeout' => 5,
            'method' => 'GET'
        ]
    ]);
    
    $jsonData = @file_get_contents($apiUrl, false, $context);
    
    if ($jsonData) {
        $data = json_decode($jsonData, true);
        if (isset($data['amphurs'])) {
            return array_column($data['amphurs'], 'name');
        }
    }
    
    // Fallback: ใช้ข้อมูลพื้นฐาน
    $basicData = getBasicAmphursData();
    return $basicData[$province] ?? [];
}

// ฟังก์ชันดึงตำบลตามจังหวัดและอำเภอ
function getTambonsByProvinceAndAmphur($province, $amphur) {
    // ถ้าเป็นบุรีรัมย์ ให้ใช้ไฟล์ buriram_addresses.json
    if ($province === 'บุรีรัมย์') {
        $jsonFile = __DIR__ . '/buriram_addresses.json';
        if (file_exists($jsonFile)) {
            $jsonData = file_get_contents($jsonFile);
            $data = json_decode($jsonData, true);
            if (isset($data['amphurs'][$amphur])) {
                return $data['amphurs'][$amphur];
            }
        }
    }
    
    // ลองโหลดจากไฟล์ JSON ก่อน
    $jsonFile = __DIR__ . '/thailand_addresses.json';
    if (file_exists($jsonFile)) {
        $jsonData = file_get_contents($jsonFile);
        $data = json_decode($jsonData, true);
        if (isset($data['provinces'][$province][$amphur])) {
            return $data['provinces'][$province][$amphur];
        }
    }
    
    // ลองดึงข้อมูลจาก API
    $apiUrl = "https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/provinces/{$province}.json";
    
    $context = stream_context_create([
        'http' => [
            'timeout' => 5,
            'method' => 'GET'
        ]
    ]);
    
    $jsonData = @file_get_contents($apiUrl, false, $context);
    
    if ($jsonData) {
        $data = json_decode($jsonData, true);
        if (isset($data['amphurs'])) {
            foreach ($data['amphurs'] as $amphurData) {
                if ($amphurData['name'] === $amphur && isset($amphurData['tambons'])) {
                    return array_column($amphurData['tambons'], 'name');
                }
            }
        }
    }
    
    // Fallback: ใช้ข้อมูลพื้นฐาน
    $basicData = getBasicTambonsData();
    return $basicData[$province][$amphur] ?? [];
}

// ข้อมูลอำเภอพื้นฐาน (สำหรับ fallback)
function getBasicAmphursData() {
    return [
        'บุรีรัมย์' => [
            'เมืองบุรีรัมย์', 'คูเมือง', 'กระสัง', 'นางรอง', 'หนองกี่', 'ละหานทราย', 'ประโคนชัย', 
            'บ้านกรวด', 'พุทไธสง', 'ลำปลายมาศ', 'สตึก', 'ปะคำ', 'นาโพธิ์', 'หนองหงส์', 
            'พลับพลาชัย', 'ห้วยราช', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 
            'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง'
        ]
    ];
}

// ข้อมูลตำบลพื้นฐาน (สำหรับ fallback)
function getBasicTambonsData() {
    return [
        'บุรีรัมย์' => [
            'เมืองบุรีรัมย์' => [
                'ในเมือง', 'สะแกซาน', 'บ้านบัว', 'บ้านคู', 'บ้านด่าน', 'สามแยก', 'สะแกโพรง', 
                'บ้านยาง', 'จันทบเพชร', 'บ้านใหม่', 'เขากระเทียม', 'อิสาณ', 'สำโรง', 'หนองตาด'
            ],
            'คูเมือง' => [
                'คูเมือง', 'ปะเคียบ', 'บ้านแพ', 'หนองไผ่', 'หินเหล็กไฟ', 'ตูมใหญ่', 'หนองขมาร'
            ],
            'กระสัง' => [
                'กระสัง', 'สะแก', 'กันทรารมย์', 'ชุมแสง', 'บ้านปรือ', 'หนองใหญ่', 'โคกยาง', 
                'โคกสะอาด', 'บ้านด่าน', 'ประโคนชัย', 'ละเวี้ย', 'จรเข้มาก', 'ปังกู', 'โคกม้า', 
                'โคกตาพรม', 'โคกไผ่', 'ไผ่หนอง', 'ลำดวน', 'สำโรง', 'หนองยายพิมพ์', 'หัวถนน', 
                'ทุ่งแสงทอง', 'หนองโสน', 'หนองปล่อง', 'เมืองโพธิ์', 'โคกขมิ้น', 'บ้านจาน', 
                'หนองแวง', 'ปราสาท', 'โนนสูง', 'บึง', 'ทุ่งวัง', 'แก่นท้าว', 'โนนเจริญ', 
                'หนองไผ่', 'ท่าแค', 'ลำปลายมาศ', 'โคกกลาง', 'แสลงพัน', 'ทะเมนชัย', 'ตลาดโพธิ์', 
                'สำโรง', 'โนนขวาง', 'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 
                'ทุ่งจังหัน', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'นางรอง' => [
                'นางรอง', 'สะเดา', 'ชุมแสง', 'หนองโบสถ์', 'หนองกง', 'ทุ่งจังหัน', 'หนองแวง', 
                'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 
                'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 
                'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'หนองกี่' => [
                'หนองกี่', 'เย้ยปราสาท', 'เมืองไผ่', 'ดอนอะราง', 'หนองไผ่', 'ท่าแค', 'ลำปลายมาศ', 
                'โคกกลาง', 'แสลงพัน', 'ทะเมนชัย', 'ตลาดโพธิ์', 'สำโรง', 'โนนขวาง', 'โคกสะอาด', 
                'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 'ทุ่งจังหัน'
            ],
            'ละหานทราย' => [
                'ละหานทราย', 'ตาจง', 'สำโรงใหม่', 'หนองแวง', 'หนองตะครอง', 'โคกว่าน', 'หนองแวง', 
                'ห้วยยาง', 'ทุ่งจังหัน', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'ประโคนชัย' => [
                'ประโคนชัย', 'แสลงโทน', 'บ้านไทร', 'ละเวี้ย', 'จรเข้มาก', 'ปังกู', 'โคกม้า', 
                'โคกตาพรม', 'โคกไผ่', 'ไผ่หนอง', 'ลำดวน', 'สำโรง', 'หนองยายพิมพ์', 'หัวถนน', 
                'ทุ่งแสงทอง', 'หนองโสน', 'หนองปล่อง', 'เมืองโพธิ์', 'โคกขมิ้น', 'บ้านจาน', 
                'หนองแวง', 'ปราสาท', 'โนนสูง', 'บึง', 'ทุ่งวัง', 'แก่นท้าว', 'โนนเจริญ', 
                'หนองไผ่', 'ท่าแค', 'ลำปลายมาศ', 'โคกกลาง', 'แสลงพัน', 'ทะเมนชัย', 'ตลาดโพธิ์', 
                'สำโรง', 'โนนขวาง', 'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 
                'ทุ่งจังหัน'
            ],
            'บ้านกรวด' => [
                'บ้านกรวด', 'โนนเจริญ', 'หนองไม้งาม', 'ปราสาท', 'สายตะกู', 'หินลาด', 'บึงเจริญ', 
                'จันทบเพชร', 'เขาดินเหนือ', 'เขาดินใต้', 'บ้านยาง', 'สำโรง', 'หนองตาด', 'โนนดินแดง', 
                'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'พุทไธสง' => [
                'พุทไธสง', 'มะเฟือง', 'บ้านจาน', 'หนองแวง', 'ปราสาท', 'โนนสูง', 'บึง', 'ทุ่งวัง', 
                'แก่นท้าว', 'โนนเจริญ', 'หนองไผ่', 'ท่าแค', 'ลำปลายมาศ', 'โคกกลาง', 'แสลงพัน', 
                'ทะเมนชัย', 'ตลาดโพธิ์', 'สำโรง', 'โนนขวาง', 'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 
                'หนองแวง', 'ห้วยยาง', 'ทุ่งจังหัน'
            ],
            'ลำปลายมาศ' => [
                'ลำปลายมาศ', 'หนองคู', 'แสลงพัน', 'ทุ่งจังหัน', 'ตลาดโพธิ์', 'สำโรง', 'โนนขวาง', 
                'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 'ทุ่งจังหัน', 'โนนสุวรรณ', 
                'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'สตึก' => [
                'สตึก', 'นิคม', 'ทุ่งวัง', 'เมืองแก', 'หนองใหญ่', 'ร่อนทอง', 'แคนดง', 'ดงพลอง', 
                'สระบัว', 'หนองกลับ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 
                'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'ปะคำ' => [
                'ปะคำ', 'ไทยเจริญ', 'หนองบัว', 'โคกมะม่วง', 'หูทำนบ', 'โนนดินแดง', 'บ้านด่าน', 
                'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 
                'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'นาโพธิ์' => [
                'นาโพธิ์', 'บ้านคู', 'บ้านดู่', 'ดอนกอก', 'ศรีสว่าง', 'โนนดินแดง', 'บ้านด่าน', 
                'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 
                'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'หนองหงส์' => [
                'หนองหงส์', 'เหล่าพรวน', 'หนองโสน', 'หนองปล่อง', 'เมืองโพธิ์', 'โคกขมิ้น', 'บ้านจาน', 
                'หนองแวง', 'ปราสาท', 'โนนสูง', 'บึง', 'ทุ่งวัง', 'แก่นท้าว', 'โนนเจริญ', 'หนองไผ่', 
                'ท่าแค', 'ลำปลายมาศ', 'โคกกลาง', 'แสลงพัน', 'ทะเมนชัย', 'ตลาดโพธิ์', 'สำโรง', 
                'โนนขวาง', 'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 'ทุ่งจังหัน'
            ],
            'พลับพลาชัย' => [
                'พลับพลาชัย', 'หันตรา', 'พระยา', 'เจริญสุข', 'บ้านปรือ', 'หนองใหญ่', 'โคกยาง', 
                'โคกสะอาด', 'บ้านด่าน', 'ประโคนชัย', 'ละเวี้ย', 'จรเข้มาก', 'ปังกู', 'โคกม้า', 
                'โคกตาพรม', 'โคกไผ่', 'ไผ่หนอง', 'ลำดวน', 'สำโรง', 'หนองยายพิมพ์', 'หัวถนน', 
                'ทุ่งแสงทอง', 'หนองโสน', 'หนองปล่อง', 'เมืองโพธิ์', 'โคกขมิ้น', 'บ้านจาน', 
                'หนองแวง', 'ปราสาท', 'โนนสูง', 'บึง', 'ทุ่งวัง', 'แก่นท้าว', 'โนนเจริญ', 
                'หนองไผ่', 'ท่าแค', 'ลำปลายมาศ', 'โคกกลาง', 'แสลงพัน', 'ทะเมนชัย', 'ตลาดโพธิ์', 
                'สำโรง', 'โนนขวาง', 'โคกสะอาด', 'บ้านใหม่', 'ทุ่งโพธิ์', 'หนองแวง', 'ห้วยยาง', 
                'ทุ่งจังหัน'
            ],
            'ห้วยราช' => [
                'ห้วยราช', 'สามแยก', 'ตาเสา', 'บ้านตะโก', 'สนวน', 'โคกขมิ้น', 'ปะคำ', 'ไทยเจริญ', 
                'หนองบัว', 'โคกมะม่วง', 'หูทำนบ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 
                'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'โนนสุวรรณ' => [
                'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 
                'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'โนนดินแดง' => [
                'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 
                'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 
                'บ้านใหม่ไชยพจน์'
            ],
            'บ้านด่าน' => [
                'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 
                'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'แคนดง' => [
                'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 
                'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'เฉลิมพระเกียรติ' => [
                'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 
                'แคนดง', 'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'ชำนิ' => [
                'ชำนิ', 'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 
                'เฉลิมพระเกียรติ', 'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ],
            'บ้านใหม่ไชยพจน์' => [
                'บ้านใหม่ไชยพจน์', 'โนนสุวรรณ', 'โนนดินแดง', 'บ้านด่าน', 'แคนดง', 'เฉลิมพระเกียรติ', 
                'ชำนิ', 'บ้านใหม่ไชยพจน์'
            ]
        ]
    ];
}

echo json_encode(['error' => 'Invalid action'], JSON_UNESCAPED_UNICODE);
?>
